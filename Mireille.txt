#------------------------------------------------------------------------------#
# 'Mireille' Bulletin Board System
# - Mireille Manpage -
#
# $Name$
# $Revision$
# "This file is written in shift_jis, CRLF." 空
# http://www.airemix.com/
# naruse@airemix.com
# Scripted by NARUSE,Yui.
#------------------------------------------------------------------------------#
# $Id$
◇これはなにか
 「ほんのりと寂れの匂いがしつつもなんとか賑わっている個人サイトの雑談系掲示板向け、
 高機能CGI/Perl掲示板システム」です、目標は
 この目標を達成するためには気乗りしない機能でもつける予定、
 技術的＆労力的＆需要的に可能ならば

◇対応サーバー
 OS:    UNIX系,WinNT系（Win9xとMacOS9以下ではflockが動きません）
 httpd: IIS5以上とApacheで確認、他のものでもCGI/Perlが動けば多分
 Perl:  5.005_03以降
◇対応ブラウザ
 WinIE5.01以上（WinIE6以上を推奨）
 Mozilla1.0.0以上
 Opera7？
 そのほかのブラウザでも多分読めます
 WinIE4,MacIE,Netscape4,Opera,iCabなどでも、記事の読み書きができない場合は教えてください
 最低限記事の読み書きは出来るべきだと思っていますので
◇設置？
まず、Mireille.txtとMireille.html以外は漢字コードがShift_JISでなく、EUC-JPです
メモ帳で文字化けしてしまうのは仕様であってバグではありません
詳しい説明はこの文章の「/特筆すべき注意/文字化けするときは」で、

とりあえず必須ファイルだけ。
/bbs/          777
/bbs/index.cgi 755
/bbs/core.cgi
/bbs/iconctlg.cgi
/bbs/style.pl
/bbs/style.css
/bbs/log/      777
/bbs/log/0.cgi 666 or そのまま
広告が自動挿入されるサーバーなどで動かしたときに、画面が真っ白になってしまう場合は、
index.cgiの中の $CF{'conenc'}='|gzip -cfq9'; という所を $CF{'conenc'}=''; としてください
#コメントアウトではダメ
詳しい設置説明は同梱のMireille.htmlを参照してくださいまし


#------------------------------------------------------------------------------#
◇Coming soon...?/memo.
・suオプション
 管理者パスワードが「hoehoe」の時に、投稿時オプション欄に「su=hoehoe;」と入れておくと、
 それ以降Cookieに管理者であることが保存され、いちいち管理者パスワードを入れなくても、
 記事の削除や修正、 最大子記事数制限に達したスレッドへの返信などができるようになる
 セキュリティホールを作りこみかねないので慎重に実装しないと
・ある程度長いスレッドでは、新しい方から指定個数の子記事のみ表示する
 ２ちゃんねるの掲示板システムで実装されている機能、だそうです
 Mireilleに実装するかは未定
・一スレッドあたりの最大子記事数を制限する
 昔に西名さんの掲示板で、利用規約として行われていた「レスは20件まで」といった取り決めを、
 Mireilleの機能として実装する
 制限に達したスレッドには返信することができない
 ただし、管理パスワードを記事パスワードとして入れておくと返信ができる
 ！実装済み
・IE6sp1で記事ナビの半透明化切り替えが重いような
 具体的にはfilters['alpha']周りが妙に重くなってる気が
 応急処置はしてみたが、IE側の問題なためMireille側では限界があります
 IE6sp2やIE6.5で修正されるのを待ってください、、
・mod_gzip or open-gzip?
 基本的にopen-gzipするようにしているけれど、
 mod_gzipなサーバーでは強制的に、open-gzipをしないようにしようかな
 #->mod_gzipはCGIの出力を圧縮してくれない（少なくともAiremixのサーバーでは）
・MireilleIconList規格の強化
 #BNKもどきで書くと今はこんな感じ
 ( 'BEGIN' | 'END' ) '_' ( 'VENDOR' | COPY1' ) (#x20 |#x9)+ <VALUE>?
 ( 'VENDOR' | 'COPY1' ) '_' ( 'NAME' | URL' | 'LINK' ) (#x20 |#x9)+ <VALUE>
  #BEGIN_では<VALUE>を取れる、これはVENDOR_NAMEに本来入る<VALUE>である、つまり略記
 #上を下みたいな感じに拡張したい
 ( 'BEGIN' | 'END' ) '_' ( 'VENDOR' | COPY1' ) (#x20 |#x9)+ <VALUE>
 ( 'VENDOR' | 'COPY1' ) '_' ( 'NAME' | URL' | 'LINK' | 'COMMENT' ) (#x20 |#x9)+ <VALUE>
 'PAGE_' ( 'TITLE' | 'GROUP' | 'COMMENT' ) (#x20 |#x9)+ <VALUE>
 #PAGE_命令群はそのページに対しての情報を付加する
 #さらに、同じキャラで表情が違う、といったのをグループ化したい
 # #Marldiaでは強引にやっているが、その方法では限界がある
 
 もっといい案がほしいな。。
 アイコン配布サイト側がこの形式のアイコンリストを配布する〜までいけば最高です
・Undocumentedな事項を文章化する
 コマンド周りに特に文章化されていない機能が多数存在します
 マニュアルとして整形するのが面倒だったり、そもそも実験的な実装なので変わる可能性があるのだ、
 とか言ってますが、文章化するべきな気がします
 当面は細かい挙動や隠れた機能を知りたい方はソースを見てください
 わかりにくい場合はコメントをつけたり、コメントの文章を練り直すのでご一報を


#------------------------------------------------------------------------------#
◇Mireille History
2002-11-15 Revision 1.2.4
版付け規則を変更
+core.cgi,style.pl
 一スレッドあたりの最大子記事数を制限する機能を実装
+style.css
 warningクラスを新設
+artnavi.js
 WinIEでJavaScriptエラーが出るのを修正
 フレームをリサイズした時に記事ナビが自動で移動しなくなってたのを修正
2002-10-29 Revision 1.2.3.8
+core.cgi
 記事スレッド数が制限を越えた時の、古いスレッドを削除する方法を調整
 記事削除時に削除後のバックアップファイル名が衝突したときの対策
 設定次第で"Last-Modified"を返すようにした
 設定次第で"304 Not Modified"を返すようにした
 検索モードでの記事検索を（多分）高速化
 記事本文処理をいろいろと修正
+index.cgi,manage.cgi
 設定可能な項目に useLastModified と use304 を追加
+style.pl
 「この記事スレッドに返信」からのリンクでは返信先の最後の記事が見えるようにした
+style.css
 フォーム周りのデザインの変更
+artnavi.js
 InternetExplorerにおいて記事ナビの半透明化切り替え処理を軽量化
2002-10-07 Revision 1.2.3.7
+index.cgi
 許可タグを'ACRONYM CODE DEL DFN EM Q SMALL STRONG RUBY RB RB RT RP'にした
+core.cgi
 返信モードで、元記事スレッドをスクロール窓内に押し込めるようにしてみた
 getTruncated関数が改行を防いでいなかったのを修正
 URI自動リンク機能で挿入したAタグが残ってしまうバグを修正
 "304 Not Modified"機能を仮実装
+core.cgi,style.pl
 日付表示回りを調整
 $ENV{'TZ'}をちゃんと解釈してくれないサーバーでもちゃんと時差を解釈するようにした
+style.css
 ACRONYM DFN Qの指定を追加
+manage.cgi
 ファイル名を変更しないと管理CGIを起動できないようにした
2002-10-01 Revision 1.2.3.6
関数名を一部変更した
なんとなくコマンドライン引数を取れるようにしてみた
+index.cgi
 デフォルトで使用可能なタグにQを追加
+index.cgi,manage.cgi
 色リストをindex.cgiで指定するようにした
+core.cgi
 $CF{'tags'}を'ALLALL'と指定するとほぼ確実にログが壊れるバグを修正
 HTTP_USER_AGENTからの不正な文字列を取りきれてなかったバグを修正
 何らかの理由でログスレッドファイル末尾の改行が無くなっている時に補うようにした
 書き込み時の記事種別判定方法を変更
 語句強調機能で挿入したSTRONGタグが残ってしまうバグを修正
 閲覧専用モードを実装
+style.pl
 一時保存/読み込みのショートカットキーを変更
 一時保存/読み込みの動作を修正
2002-09-27 Revision 1.2.3.5
HTMLをHTML4.01Transitionalっぽくした
+index.cgi,manage.cgi
 gzip圧縮転送のやり方スイッチを追加
 色を選択式にした場合、初期設定の色を指定できるようにした
 Cookieを登録するpathを選べるようにした
+core.cgi
 URLに & を含むものを自動リンクしてくれなかったのを修正
 タグを全面禁止すると本文が改行できなくなるバグを修正
 有名所のCGIに広告を強制挿入する無料CGIサーバーでは、GZIP圧縮転送が有効にならないように
 題名がない時、削除・修正機能で本文の引用する時に文字列を切り取る関数のバグ修正
 題名が入力されていない時に本文を使うが、そのときにタグを消しきれてなかったのを修正
 書き込んだ後記事をプレビューする機能を追加
+style.pl
 色選択の選択肢を色名のある色140色に増量、適宜削って使ってください
 本文の一時保存機能を追加
+artnavi.js
 記事ナビの拡大縮小閉じるをキーボードショートカットからできるように //多少ブラウザ依存
+manage.cgi
 "Back to HOME"から"Back to INDEX"へ変更
+iconctlg.cgi
 icon.htmlを使わず、iconctlg.cgiをrequireしてその場で見本を生成するようにした
2002-08-31 Revision 1.2.3.4
+core.cgi
 修正･削除機能のページ移動が動いていなかったのを修正
 修正・削除モードの記事本文の抜粋で、改行を \n であらわしていたのを ↓ で表すようにした
 修正・削除モードの記事本文の抜粋で、100文字を超えている場合 ... と末尾につけるようにした
 修正・削除モードの記事一覧のデザインをちょっと変更
+core.cgi,style.pl
 WindowsXPの場合、Windowsの新UI非対応のIE系ブラウザでも新UIになるようにしてみた
+style.pl
 記事投稿時に名前やパスワードを入れ忘れても本文の内容が消滅しないようにした
+artnavi.js
 Opera以外でJavaScriptエラーが出るバグを修正
 Operaでも記事ナビ最小化・閉じるができるようにした
 IEにおける記事ナビの半透明化切り替え処理に条件コンパイル構文と名前付け規則を導入
+style.pl,style.css
 フォーム周りで選択すると色が変わる処理の方法を変更
+manage.cgi
 アイコン見本生成周りをリファクタリング
その他
2002-08-10 Revision 1.2.3.3
+core.cgi
 管理パスによる修正機能が壊れていたバグを修正
+artnavi.js
 Operaでスクロール時に記事ナビが消えていくバグを修正
+style.css
 微調整
+Mireille.html
 どことなく漢字変換の修正やデザインの修正など
2002-08-08 Revision 1.2.3.2
+index.cgi,manage.cgi
 専用アイコンの説明が間違っているのを修正 #"icon=moe"->"icon=hoe"
+style.pl,style.css,artnavi.js
 記事ナビの縮小ができなくなっていたのを修正
2002-08-08 Revision 1.2.3.1
Netscape4でもCSSを適用できるように調整
+index.cgi
 デフォルトの使用を許可するタグからPREを削除 #やっぱりなくても大丈夫だった
+core.cgi
 タブを半角空白二個でなく、NoBreakSpace二個で置換するようにした
+style.pl
 注意書きの「Newマークがつくよ」で$CF{'new'}を使わず標準Newマークを前提にしていたのを修正
+manage.cgi
  アイコンページを作成するとフッタのAiremixアドレスが旧アドレスのままなのを修正
  管理CGI自体のファイル名取得する時に、__FILE__が[^/\\:]を含まないと取得できないのを修正

2002-07-21 Revision 1.2.2.23
インデントの半角空白2個"  "をタブ1個にした
+srtnavi.js,style.pl
 記事ナビをOperaに対応させた
+index.cgi
 デフォルトの使用を許可するタグにPREを追加 #ないとcodeをインデントできないので
 デフォルトの強調語句に /(\s+(?:\/\/|#|＃).*)/ をコメントとして追加
+core.cgi
 「//@a=qw」がメールアドレスとして認識されてしまうバグを修正
+style.pl
 Mozilla1.0の:hover-MozOpacity-overflowコンボ回避の方法をoverflow-yから-moz-opacity:0.9に変更
 色リストにblue,green,orange,redを追加
+style.css
 h1.headなどにcolor:#fff;を追加 #OperaだとTableのcolorが継承されないことへの対処
+manage.cgi
 configの読み込みに成功しているのに失敗したと表示するバグを修正
+Mireille.html
 画面が真っ白になり動作しないケースの対策を追加、他
2002-06-13 Revision 1.2.2.22
+core.cgi
 記事の削除の際に$CF{'delthr'}='!bzip2 -zq9';などでそのコマンドを使うことにした
 gzip圧縮転送失敗時のエラー画面データをuuencodeしておくことでより場所をとらないようにした
+manage.cgi
 ログ削除□〜□型のバグを修正
 Marldiaの表情アイコンを含んだリストでも、アイコンリスト編集＃が使えるようにした
+artnavi.js
 Cookieセットのタイミングをちょっと調整
 N6/Mozillaでリロードしたときに記事ナビが行方不明になるバグを修正
+style.css
 Mozilla1.0が記事ナビの本文をクリックすると落ちてしまうバグに対して回避処置
2002-05-26 Revision 1.2.2.21
+index.cgi,core.cgi,manage.cgi
 $0が空な所でも動作するように修正
+style.css
 Mozillaでも記事ナビにマウスオーバーで透明度が変わるように修正
 Mozilla用に一部属性セレクタを使ったスタイル指定を加えた
+style.pl
 iconPreviewのIMG altにアイコンのファイル名を入れるように変更
 記事スレッドのルートDIVにtitleをつけた
 core.cgi内のHTMLヘッダ部分を切り出した
+manage.cgi
 アイコン見本の著作権表示の部分をちょっと修正
 index.cgi設定にヘルプファイルの項目を追加
+artnavi.js
 記事ナビの調整
+Mireille.html
 利用規約の表現の仕方を変更
 説明をもっとわかりやすく
その他
2002-05-10 Revision 1.2.2.20
+core.cgi
 未読記事を知らせる部分で無駄な1という文字が出てしまうのを修正
 修正/削除の記事リストが出ないバグを修正
+manage.cgi
 エラーメッセージをもうちょっと細かく
+Mireille.html
 説明をもっと細かく
その他
2002-05-05 Revision 1.2.2.19
+core.cgi
 正規表現を一部indexに置き換え
+artnavi.js
 IE5.01で「型が違う」とのエラーが出ていたのを修正
その他
2002-05-02 Revision 1.2.2.18
sysopenとFcntl.pmを使わないようにした
+core.cgi
 語句強調・自動URLリンク・タグ許可まわりの調整
2002-04-29 Revision 1.2.2.17
正規表現/(["'])[^\1]/は/"[^"]|'[^']/の意味で、/["'][^\001]/ではないと思っていたバグを修正
+core.cgi
 語句強調・自動URLリンク・タグ許可まわりの調整
+style.pl
 Cookieが無い状態だと最初はに投稿フォームのアイコンプレビューが表示されない問題を修正
+help.pl
 利用規約の追加 #リスクヘッジ的なものです^^;;
一部リファクタリングしたためバグを埋め込んだ可能性あり
2002-04-21 Revision 1.2.2.16
+style.css
 漢字コードをShift_JISからEUC-JPへ
 本体と外部CSSの漢字コードが違うとIE5.01の一部でCSSが読み込まれないようなので
+help.pl
 アイコンとクッキーの項目を追加
+Mireille.html
 説明をより詳しく修正
そのほか調整
2002-04-12 Revision 1.2.2.15
+core.cgi
 語句強調の取得方法を変更
 検索で「正しくパターンマッチさせる」ように
 GZIP出力に失敗した時に、ちゃんとエラー表示をできるように
 その他大量にリファクタリング
+help.pl
 記事の削除に関して言及
+artnavi.js
 CookieをSessionCookieとして渡すように
 Cookieに渡す時に記事ナビの座標を間違えていたのを修正
2002-04-04 Revision 1.2.2.14
flock周りを修正
Win9xでもflockがないことによって落ちないようにした
+core.cgi
 語句強調を拡張できるようにした
+style.pl
 複数アイコンリストのファイル名取得部分の精度を上げた
+manage.cgi
 語句強調の部分の説明を微妙に変えてみた
 その他説明の文章を変更してみる
2002-03-21 Revision 1.2.2.13
試験的に色選択の色表示をbackground-colorからcolorへ
強調表示追加
+core.cgi
 GZIPをしないときに「NG」という文字がでるのを修正
 $CF{'tags'}にALLと入れることで全タグを無条件で使用可能にできるようにした
+manage.cgi
 管理CGI上から、管理CGIのファイル名変更・削除ができるようにした
+style.css
 table{margin:1em auto}を追加＆他のtable系CSSでこれと被った分を削除
+artnavi.js
 Mozillaで初期ページ以外の時記事ナビがついてこないのを修正
+help.pl
 強調表示の情報をより詳しく
その他
2002-02-17 Revision 1.2.2.12
index.cgiの更新が必要です
+index.cgi,core.cgi,manage.cgi
 削除方法に'GZIP圧縮'を追加＆バグ修正＆autodel,del→delold,delthrに
 gzip圧縮周りを調整
+style.css
 Mac対策にfont-family指定にOsaka追加
2002-01-31 Revision 1.2.2.11
+index.cgi,manage.cgi
 core.cgiをstyle.plより先にrequireするようにした
 ->core.cgi内のサブルーチンを、style.plで上書きできるようになった
+core.cgi
 エラー表示をもうちょっとわかりやすく
 ログディレクトリや0.cgiが設置されていないときに、勝手に設置しようとする機能を復活
+core.cgi,style.pl
 引数に何をとるかコメントに書いてみた
+Mireille.html
 誤字脱字修正
+artnavi.js
 Macで記事ナビの上にマウスカーソルを置くと落ちる現象に対して勘で修正を試みる #道遠し
#おまけ
強調に ◇ s819e ◆ s819f □ s81a0 ■ s81a1 を仮に追加
2002-01-25 Revision 1.2.2.10
+core.cgi
 投稿時にパスワードエラーを出すと復帰できないバグを修正
+help.pl
 強調表示の情報を出すようにした
2002-01-16 Revision 1.2.2.9
target="_top"に。
+core.cgi
 引用強調のバグ修正
+manage.cgi
 引用強調の説明を細かに
2002-01-15 Revision 1.2.2.8
AiremixのURLを変更
+index.cgi
 引用を始めとする強調用の設定$CF{'strong'}を追加
+core.pl
 削除後の画面に「戻る」をつけた
 引用強調の処理を追加
+manage.cgi
 アイコンリストの処理を変更
+style.css
 select#icon（446行目）を追加
2002-01-02 Revision 1.2.2.7
+style.css
 h2.subjectのmarginが二つあるのを修正
+Mireille.html
 説明を強化
2001-12-20 Revision 1.2.2.6
+core.cgi,style.pl
 書き込みの前処理を拡張したい時用サブルーチン&exprewrtを追加
+help.pl,notify.pl,style.pl
 最初の十数行の形式を統一
+help.pl
 誤植修正：覚えるなければいけない→覚えなければいけない
+style.css
 .ulを.listに置換
 108行目、ol,ul{}の中身を margin-top: 0.3em; に
 512行目、h2.listの margin0; を margin: 0 0 0.3em 0; に
+help.pl,Mireille.html,manage.cgi
 class="ul"をclass="list"に置換
+style.pl
 記事フッタの返信モードを格納する変数$CF{'artfotr'}を追加
 $DT{'command'}→DT{'cmd'}バグでした^^;;
 EXコマンドの"EX"って何？削除しました
 artnavi.jsに記事ナビJavaScript部分を切り出した。
+index.cgi
 artjsとsekitmを追加。
 index.cgiのバージョンアップが必要です
その他。
2001-12-20 Revision 1.2.2.5
+core.cgi,style.pl
 id属性は英字から始まらないといけません
  name="$DT{'i'}-$DT{'j'}"→name="art$DT{'i'}-$DT{'j'}"
  id="$DT{'i'}-$DT{'j'}"→id="art$DT{'i'}-$DT{'j'}"
  #??→#art??
 記事ナビのCSS情報ををstyle.cssに出した
+help.pl
 使用可能タグ部分を修正
2001-12-19 Revision 1.2.2.4
+core.cgi,style.pl
 記事ナビボタンの取り付け方を変更
 icon,color周りの修正
+help.pl
 設定情報の表示の仕方を変更
+manage.cgi
 index.cgi設定の選択系を選ぶところの表示バグを修正
+Mireille.html
 利用規約などをわかりやすい(?)ように書き換えた＆修正
2001-12-17 Revision 1.2.2.3
+index.cgi
 colway情報を追加
+core.cgi
 修正でも、記事の投稿日時を更新、スレッドの最終更新日時、を更新できるEXコマンド追加
 Cookie周りのフィルタ強化
+style.pl
 記事ナビ強化
+manage.cgi
 index.cgiの編集が可能に
+help.pl
 ヘルプをCGIへ組み込んだ
2001-11-26 Revision 1.2.2.2
+core.cgi
 「>>No.12-3でMireille内の記事に自動リンク」修正
+style.pl
 記事ナビ調整
+notify.pl
 途中でdieさせてたのを修正
2001-11-25 Revision 1.2.2.1
+core.cgi,style.pl
 新記事ナビ取り付け
 一部表記を変更してみた
 ">>No.12-3"でMireille内の記事に自動リンク
+style.css
 table.headに「margin: auto;」を追加
2001-11-25 Revision 1.2.1.14
+core.cgi,notify.pl
 記事題名とメールお知らせ関連のバグ修正
2001-11-24 Revision 1.2.1.13
+mage.cgi
 アイコン一覧を調整
2001-11-21 Revision 1.2.1.12
+core.cgi
 記事投稿後そのまま修正できないバグを修正
 多重投稿防止機構を修正
 新規書き込みできないバグを修正
 修正時に恣意的に破壊的な変数を通せたのを修正
+style.css
 無用なbackground-color: #fff;を削除
+style.pl
 colorとiconの内部処理仕様変更
+convert12.cgi
 nobodyの判定を間違えてたのを修正
2001-11-14 Revision 1.2.1.11
全体的に処理の調整
+manage.cgi
 ZeroFileリカバリするとMir12型ログでないというバグを修正
2001-11-11 Revision 1.2.1.10
記事情報系を調整
+style.css
 251行目：2em->1em
 291行目：2em->1.5em
+notify.pl
 バグ修正
2001-11-09 Revision 1.2.1.9
+style.pl
 記事ナビ調整
 アイコンの初期値設定が壊れてた^^;;
+notify.pl
 バグ修正^^;;
その他
2001-11-05 Revision 1.2.1.8
+core.cgi
 修正/削除リストの一行引用を修正
+style.pl
 子記事のNew!を消してしまっていたのを修正
+notify.pl
 直接は関係のない微調整
2001-11-04 Revision 1.2.1.7
記事ナビ調整
notify.pl修正
manage.cgi修正
2001-11-02 Revision 1.2.1.6
ついに記事ナビ仮実装！
実行ファイル判別に「$0 eq __FILE__」を使うようにした
+core.cgi
 IEでGZIP転送時に「更新」を押した時、最初の2KBが跳ぶバグを考慮
2001-10-29 Revision 1.2.1.5
+core.cgi
 ▽0△6の調整
 本文を一行しか書けないバグを修正
+style.pl
 ▽0△6の調整
 上に伴い「新規投稿」のAccesskeyを廃止
 #「むやみと新スレッドを立てるべからず」という意味だと解釈してください^^;;
+help.html
 ファイル構成の変更を反映。ほか。
2001-10-26 Revision 1.2.1.4
 index.cgiの変数調整
 h1.head内のリンクをh1.head aにした
2001-10-21 Revision 1.2.1.3
 一部変数名の変更
 投稿フォーム周りのCookie保持法を変更
+CSS
 a.user -> td.body a
 h3.artfot -> div.thread p.foot
 th.wrtfot -> table.write th.foot
2001-10-19 Revision 1.2.1.2
 致命的バグを修正
2001-10-19 Revision 1.2.1.1
 全面的に改修
2001-10-08 Revision 1.2.0.7
+manage.cgi
 ZeroFile回復モード追加
+core.pl,style.pl
 書き込みフォームをとりあえず切り出してみる
2001-10-04 Revision 1.2.0.6
+manage.cgi
 アイコン見本周辺のHTMLのミスを修正
+style.pl
 題名のショートカットキーを0->j
+style.css
 .AiremixCopy新設 #それぞれにこれに伴う変更
 コメントを一部調整
2001-10-02 Revision 1.2.0.5
デザイン関連の修正を全体的に
2001-10-01 Revision 1.2.0.4
西名さんによるデザイン調整
caution -> note #変数名がnoteだったので
td.title->th.title #題名系はthしたいという個人的な好みより
style.cssで使っていないところを一部削除
+index.cgi
 アイコンヘッダフッタを移動
+core.pl
 検索機能が壊れていたのを修正
 記事修正部の処理を調整
 Passwordの文字数制限を1-30文字から1-24文字に
 管理Passは文字数制限をなくした
+manage.cgi
 index.cgi,style.plから読み込んでアイコン一覧を生成できるように
2001-09-28 Revision 1.2.0.3
+core.pl
 修正機能が使えなかったのを修正
 題名の引用がうまくできていないのを修正
 マスターパスで削除しようとすると親記事の画面が出るバグを修正
2001-09-27 Revision 1.2.0.2
+index.cgi,style.pl,core.pl
 Perl5.6未満で動かないのを修正
 エラー捕獲を訂正
2001-09-26 Revision 1.2.0.1
+index.cgi
 今までのconfig.plのシステム設定を切り出したもの
+core.pl
 今までのindex.cgiを外部にした
+style.pl
 旧index.cgiと旧config.plのデザインに関する部分を切り出したもの


#------------------------------------------------------------------------------#
◇既知の問題（相対バグ）
□許可タグに"STRONG"を入れると、語句強調と衝突する可能性がある
 ユーザーの入力するSTRONGタグが /<STRONG class="[^"]*">.*<\/STRONG>/ にマッチしないものなら大丈夫です
 語句強調の使用するclass名を、特定の文字列から始めるようにする、
 といった対策も検討してはいます #つまり当分対策予定なし
□許可タグに"A"を入れると、URI自動リンクと衝突する可能性がある
 少なくとも /^<A class="autolink"/ にマッチしなければ大丈夫です
□MSIE以外でToolTipの"\n"がちゃんと表示されないことがある
 現実的な対処法を模索中です・・・
□HTML/CSSでvalidでない部分がある
 TABLEをレイアウトに使っている
 StrictにないA targetを使っている
 CSSのime-mode,filter,-moz-opacityプロパティ
 DIVとTABLEでごちゃごちゃやってる->Netscape4対策
□アイコンリストや色リストの形式はHTML完全互換でない
 処理の簡便化のため、一部互換性を省いています
<OPTION value=hoe.png>ほえ
 はHTML4では正当なものですが、Mireilleはvalueの値を""でくくっていない為と、
 </OPTION>が無いために解釈することが出来ません #出来ることもあるけど
□表現が統一できてない、または表現が適切でない部分がある
 例えば、 
・「アイコン一覧/IconList/アイコン見本/IconSample/IconPreview」
 互いにまぎらわしいぞ
・フォーム「ホーム」
 「ホーム/HOME/URL/ホームページ/HP」の中から「ホーム」を選んだ当時のわたしに乾杯（謎
・「コマンド」
 「コマンド」って何さ？飾りですよ
・「投稿された記事の著作権は管理者の管理下におかれます。」
 もっとうまい言い方はないのかね
・メニュー「更新」
 更新ってなんだ？何を？
・メニュー「ホーム」
 フォーム側と整合性は取れているけど・・・もっとうまい表現無いの？
・「BACK to HOME/Contents/Index」
 どこに行くのか解りづらい上に、そもそもどこに行ってもらうべきか不明
・「ヘルプ」といいつつ
 ろくに助けになってない（ぉ
 
 などです
 修正案を思いついた方は教えてくださいまし


#------------------------------------------------------------------------------#
◇現在予定していること
 TODOです
□Airemix標準配布スタイルを何種類か用意する
 これは1.2.1.x時代から予定しているのですが、いまだに達成できていません
 style.plを何種類か用意して配布するといいかな〜と思いつつ、そのままほったらかし。。

#------------------------------------------------------------------------------#
◇夢。
 いつかやりたいけれど当分できなさそうなこと
□より自由度の高いスタイルの変更
 ツリービューにしたり、果ては日記のように使えるようにしたり
□Unicode化
 EUC/SJISの呪縛から逃れたい
□ログ形式の変更
 XMLデータベースなんか使えたら素敵ですね
□開発言語の変更
 RubyとかC#とか

#------------------------------------------------------------------------------#
◇現在予定していないこと
 TODOの逆、みたいなものです
 以下にあげるものは現在、半永久的に実装予定がありません
 理由は「ポリシーに反するから」でも「つけるのが無理だから」でもなく、
 「使う人がいなさそうだから」ですので、使う人がいればつけます
□「検索する単語」で正規表現を使えるようにするorAND/OR検索
 今はquotemeta関数で文字列にしています
 正規表現を使えるとより複雑な検索が出来ます
□携帯端末用モード
 Mireilleでも昔は別CGIであるsimple.cgi（最終版はBeta60）によって対応していましたが、
 Rev:1.1でのログ形式変更によって非対応になってしまい、その後ほったらかしとなっています
 何度か対応させようかと思ってAiremixの掲示板で話題を出してみましたが反応がなかったため、
 携帯端末でMireilleを見ようという需要がない、と判断しました
 このままずっと様子見を決め込んでいれば、携帯端末でもそのまま見れるようになるかも(?)
 という怠け心もわいています（ｗ
□P3P対応
 そもそもこの存在を知っているユーザーが少ないと思われる


#------------------------------------------------------------------------------#
◇語句強調の方法
 $DT{'strong'}に' '（半角空白）区切りで、
$CF{'strong'}='// s2f2 ＞ s8184 ＃ s8194 ◇ s819e ◆ s819f □ s81a0 ■ s81a1 ※ s81a6';
 のように、強調する記号と対応するCSSのクラスを列挙します
 
 このとき、最初の一文字が
$CF{'strong'}=' // s2f2f /(/\*[^*]*\*+(?:[^/*][^*]*\*+)*/)/ s2f2a ＞ s8184 ＃ s8194';
 のように' '（半角空白）だった場合拡張モードになります
 記号やクラスの前後を//で囲んだものはそのまま正規表現として代入され、
$DT{'body'}=~s[$regexp][$ST{$_}]gm;
 と置換作業に利用されます
 
 ちなみに、記号とクラスは別々に、そのまま正規表現として代入するか、判定されます
 上の例では /* ・・・ */ というC言語のコメント部分に、s2f2aというCSSクラスを与えます
 
 文字列内に' '（半角空白）を書きたい場合は、8進数文字コードで\040と書くか、
 16進数文字コードで\x40と書いてください


#------------------------------------------------------------------------------#
◇アイコンまわりの説明
□index.cgiのアイコンディレクトリ設定
 $CF{'icon'}の設定は最後に/を含めてください

□アイコンリスト
 $CF{'icls'}の最初の一文字が' '（半角空白）だった場合複数リストモードになります
 具体的な例を出すと、
 ・単一とみなされる例
	'icon.txt'
	'icon1.txt icon2.txt' #"icon1.txt icon2"というテキストファイルだとみなします
	'"icon.txt" "exicon.txt"'
 ・複数とみなされる例
	' "icon.txt" "exicon.txt"'
	' "icon.txt" exicon.txt'
	' icon.txt exicon.txt'

□アイコン編集
 タグ方式とSharp方式があります

 ・タグ方式
	HTML4に基づいた形で、SELECTタグ内の要素を羅列するだけです
	管理CGIはその中のOPTGROUPとOPTIONタグを認識して、アイコン見本を作成してくれます
	とりあえず例を、
<OPTGROUP label="グループ名">
  <OPTION value="アイコンファイル名">アイコン名</OPTION>
  <OPTION value="アイコンファイル名">アイコン名</OPTION>
</OPTGROUP>
<!-- %BEGIN_COPY1 SQUARE -->
<!-- %COPY1_URL http://www.playonline.com/ -->
<OPTGROUP label="FINAL FANTASY VII">
  <OPTION value="cloud.gif">クラウド</OPTION>
  <OPTION value="tifa.gif">ティファ</OPTION>
  <OPTION value="aerith.gif">エアリス</OPTION>
  <OPTION value="yuffie.gif">ユフィ</OPTION>
  <OPTION value="vin.gif">ヴィンセント</OPTION>
  <OPTION value="sephi.gif">セフィロス</OPTION>
  <OPTION value="cid7.gif">シド</OPTION>
  <OPTION value="red.gif">レッドXIII</OPTION>
  <OPTION value="barret.gif">バレット</OPTION>
  <OPTION value="cait.gif">ケットシー</OPTION>
</OPTGROUP>
<!-- END_COPY1 -->
	HTML4の仕様上はOPTIONタグは終了タグを省略できるはずですが、
	Mireilleでは省略した場合の動作は保証しません
	ちなみに、OPTGROUPタグは入れ子にできない（<OPTGROUP><OPTGROUP>とできない）
	ので注意しましょう
	これはHTML4の仕様なので、入れ子をサポートする予定は当分ありません
	HTML4の仕様のせいにしてたりなんかしません（ｗ

 ・Sharp方式
	その名の通り、"#"を使う方式です
	これも例を見たほうが早いでしょう
	タグ方式と見比べてみてください
#グループ名
  アイコンファイル名#アイコン名
  アイコンファイル名#アイコン名
#
<!-- %BEGIN_COPY1 SQUARE -->
<!-- %COPY1_URL http://www.playonline.com/ -->
#FINAL FANTASY VII
  cloud.gif#クラウド
  tifa.gif#ティファ
  aerith.gif#エアリス
  yuffie.gif#ユフィ
  vin.gif#ヴィンセント
  sephi.gif#セフィロス
  cid7.gif#シド
  red.gif#レッドXIII
  barret.gif#バレット
  cait.gif#ケットシー
#
<!-- END_COPY1 -->
	という感じです


#------------------------------------------------------------------------------#
◇CONFIGのHTMLデザイン部について
かなりの自由度でデザインを変更することが出来ます
また、メニュー$CF{'menu'}、記事$CF{'artprt'},$CF{'artchd'},$CF{'artfot'}、
投稿フォーム$CF{'wrtfm'},$CF{'resfm'}のデザイン部では、
以下の変数を使うことが出来ます
 記事番号：$DT{'i'}
 返信番号：$DT{'j'}
 名前：$DT{'name'}
 題名：$DT{'title'}
 メールアドレス：$DT{'email'}
 ホームページアドレス：$DT{'home'}
 投稿日時（"????年??月??日(？) ??時??分"型）：$DT{'date'}
 本文：$DT{'mes'}
 アイコン：$DT{'icon'}
 パスワード：$DT{'pass'}
 コマンド：$DT{'cmd'}
これら以外にも使える変数が存在することはしますが、使うべきものかどうかは微妙です


#------------------------------------------------------------------------------#
◇特筆すべき注意
□管理CGIのファイル名を変えること！
 Mireilleの管理CGI(manage.cgi)は非常に強い権限をもっているため、
 悪意の第三者にアクセスされた場合、非常に危険です
 必ずファイル名を変更しましょう
□文字化けするときは
 Mireilleは、このMireille.txtとMireille.htmlを除いて全て、
 EUCという漢字コード書かれています
 そのため、メモ帳を筆頭とする、EUC非対応のエディタでは編集することが出来ません
 EUC対応のエディタをご使用ください
 以下は推奨するエディタです
 さくらエディタ http://sakura-editor.sourceforge.net/
 TeraPad http://www2s.biglobe.ne.jp/~t-susumu/toclip/
 秀丸エディタ http://hidemaru.xaxon.co.jp/
 他にもEmEditorやWZEdiotr,Peggyなどが対応しています
 特に本格的にやるならば、色付けをしてくれるエディタだと格段に、
 効率が上がり、かつミスも減ると思います
 
 PrelFactory http://homepage1.nifty.com/wizman/ はその名の通りPerlの開発環境です
 ざっと見た限りではPerl単体の色付けに関してはケチをつけられる所はありませんでした
 
 アンカーシステムズ株式会社のPeggyPro http://www2.noritz.co.jp/anchor/ を、
 成瀬は2001年中ごろから使っています
 Perlだけでなく主要な言語からそうでない言語まで幅広いサポートが光ります
 CREC(コンテキスト正規表現カラー表示)を使って新規に言語モードを作ることで、
 新たな色づけ規則を、単なるキーワード強調以上のことができます（＞＜
 
□ファイル名変更の制限
 スタイルシートのファイル名は、
 必ず[_a-zA-Z0-9]*.cssという形式である必要があります
 つまり、-=~<>\などの記号や日本語名は使えません
□詳しい説明は同梱のMireille.htmlを参照ください


#------------------------------------------------------------------------------#
◇よくある疑問

□Q:エラーがでたっぽい
　A:「Mireille Error Screen」がでた場合は、「ERROR:」に続く英文字を見てがんばってください
　　それで討ち死にした場合はAiremixの掲示板に敗戦の弁をお願いします
　　その際に必ず上記のError Screenの内容を教えてください
　　エラーがでたCGIのURLを書いてくださるか、エラー画面を丸ごと書くか、を
　　これがあるのとないのでは原因の判明、修正の手間が全く違うのです
　　「500 Internal Server Error」がでた場合は、初歩的なミスである可能性が高いです
　　パーミッションや設定などを確認してみましょう
　　上のどちらもでていない場合は・・・悪あがきをした後、Airemixの掲示板で泣き言を、
□Q:文字化けしてます〜;;
　A:漢字コードがおそらくShift_JISになっています
　　MireilleはEUCを使っているのでEUCで保存しなおしてください
　　一部のファイルを除いて全ての他のファイルも同様です
　　「一部のファイル」がどれかは、最初から何行目かに
　　# "This file is written in shift_jis, CRLF." 空
　　のような行があるので、そこにどの漢字コードを使っているか書いてありますので、
　　それを参照してください
　　ちなみにこのファイルはShift_JISで保存してあります
□Q:それじゃなんでEUCを使うの？
　A:確かにShift_JISのほうが楽です
　　ほとんどの人はWindowsを使っているでしょうから、標準のShift_JISを使ったほうがいいですね
　　わたしも本当はWindows上での利便性を考えればShift_JISを使いたいです
　　ただ、Shift_JISだと一部の漢字においてCGI処理の中でうまく処理できないのです
　　具体的には、「print"能";」というコマンドでエラーが出ます
　　これはShift_JISでの「能」の16進文字コードが0x945cなため下の二つが、
　　0x5cである特殊文字「\」とかぶってしまうからです
　　このような文字は「能」「饅」など数十文字あります
　　回避策は何個かありますが、一番確実な回避策がEUCを使う、ということだったわけです
　　EUCにはこのようなエラーを誘発する文字が、無いように作られていますので
　　その意味では今流行の、世界中の全ての文字を一つに詰め込もうという無茶な規格、
　　Unicodeでもいいのですが、まだエディタ側の対応を見ると時期尚早だと思いますので^^;;
　　Perl側の対応もPerl5.8を待たないといまいちですし
□Q:全てがわからない！ぜんぜん無理！
　A:とりあえず今はあきらめることをお勧めします
　　それが嫌な場合は親切かつ有能な友人に頼ってください^^;;


#------------------------------------------------------------------------------#
◇Mireilleの仕様
Mireilleの構造について、実装の手法からつらつらと書き連ねておきます
「ここが知りたい」という個所があれば、言ってくだされば優先的に記述します

□CSSとその動的切り替え
 本来はCSS2の属性セレクタと擬似クラスでやるのが理想なのですが、
 そうも行かないのでいろいろ知恵をひねることになります
 
 まず、Mozillaは理想のとおり属性セレクタと擬似クラスで切り替えを行います
 この際に属性セレクタを含んだブロックと含まないブロックの両方を用意する必要があります
	.submit{
		background-color: #dde;
		border: #355 solid 2px;
		color: #355;
		cursor: pointer; cursor: hand;
		width: 7em;
	}
	INPUT[type="submit"]{
		background-color: #dde;
		border: #355 solid 2px;
		color: #355;
		cursor: pointer;
		width: 7em;
	}
 こうしないと属性セレクタを解釈できないブラウザが.submitまで無視してしまうのです
 
 次にWindowsInternetExplorerです
 これはMozillaのようには行かないので、フッター直前に置いたJScriptで処理します
 以下は$CF{'form_jscript'}をはしょったものです
<SCRIPT language="JScript" defer>
<!--
/*@cc_on
if(document.getElementsByTagName){
	var tags=document.getElementsByTagName('TEXTAREA')
	for(var i in tags){
		tags[i].className='blur';
		tags[i].onfocus=function(){this.className='focus';};
		tags[i].onblur=function(){this.className='blur';};
	}
}
// @*/
-->
</SCRIPT>
 ここで、他のブラウザに悪影響が出ないように、JScriptの条件コンパイルという方法を使っています
 http://www.microsoft.com/japan/developer/library/script56/js56jsconconditionalcompilation.htm
 上のスクリプトは速度上の問題からWinIE5以上にのみ対応していますが、WinIE4で動かすこともできます
 流石に“人類が生み出した三つの最悪なものの一つ”WinIE3では無理ですけど
 
 さて、残るOperaやNetscape4などですが、これらは無視します（ぉ
 属性セレクタにも対応しないわ、JavaScriptからのCSS切り替えもできないではどうしようもありません
 やるべきことはこれらの表示に影響が出ないように、前の二つで表示できるようにする、です
 
 MacIEは6になるころには属性セレクタにも対応してくれることでしょう
 なので様子見；）

□ログ形式
 基本的にはTSVとname=valueの折衷である、
"name=\tvalue;\tname=\tvalue;\tname=\tvalue;\t"
 という=\tと;\tで区切る方式を使っています
 \tはタブ文字のことなので、展開され、
name=	value;	name=	value;	name=	value;	
 のようになります
 実際にMireilleのログとして保存する場合は最初に管理情報を埋め込み、
 あとは任意のログ項目を列挙します
 現在の「Mir1型」ログ形式だと、
Mir12=	;	name=	名前;	subject=	テスト;	
 と保存されます
 保存したログから値を読み出す際には
my%DT=($_=~/([^\t]*)=\t([^\t]*);\t/go);
 として一括してハッシュにつめこみ、あとは$DT{'name'}で呼び出します
 このあたりの処理はちょっと気に入っています（何

 項目ごとの検索（題名に'Millefeuille'を含む記事を含むスレッドを検索）では
$sertch_word='Millefeuille';
$log=~/\ttitle=\t$serch_word;\t/o;
 とやれば、\tは区切りにしか含まれていないはずなので、必ず目的の項目が見つかります
 前に\tのない、行の最初の項目はこれでは検索できませんが、
 Mir12型では行頭は管理領域なので、普通の検索では扱いませんし、 #そもそも扱えたら困る
 システムがこれにアクセスする場合は/^Mir12/で検索するので、問題ありません

□アイコンリスト形式
 長年の研究の結果導き出された、最良のリスト形式は、「そのままタグを列挙する」でした（笑
 というわけで、SELECTタグ内に記述されるタグを列挙する、というわかりやすい形式になっています
 また、グループ分けのためHTML4で策定されたOPTGROUPタグの利用を推奨しています
<OPTGROUP label="グループ名">
  <OPTION value="ファイル名">アイコン名</OPTION>
</OPTION>
 Cookieを使って初期状態で選ばれるアイコンを選択する際には
s/value="Cookieにあるファイル名"/value="Cookieにあるファイル名" selected="selected"/
 とやる安易な方法を用いています
 この一見かつ適当に思えるリスト形式によって、大幅な高速化＆耐久性を実現・・・
 しているような、気がします（ｗ
 #とりあえず700個のアイコンでそこそこの速度での動作を確認済
 Rev:1.1.3.8以降ではHTMLコメントでアイコンの配布元情報を埋め込んだりも出来るようになっています

□カスタマイズ
 index.cgiに変数群%CFを用意することによって行っています
 HTMLを記述することによって変えられるデザインは、
 eval関数を使うことによって変数を普通に使えるように・・・
 やっぱり適当といえば適当な仕様です
 設定は、直接エディタで編集、管理CGI(manage.cgi)から操作、の2種類を用意しています
 基本的には下位互換性を確保しているため、
 多くの場合はバージョンアップをしても問題なく動作するでしょう
 管理CGIからindex.cgiへの書き込みは、地味にテンプレートのようなものを用意して、
 それに代入しつつ書き込むというシンプルな方法です
 #今はforでもうちょっと自動化してます


#------------------------------------------------------------------------------#
◇メモ
 ちょっとしたメモなのです
□Mireilleは重い？
 簡単に調べてみましたが、重いかもしれません
 原因は投稿フォームや記事表示にevalを使っているからでも、LogDir方式だからでも、
 アイコンリストが肥大化しているからでもなく、 #これらは思ったよりも軽い
 連発しているuse群のようで、特にuse Fcntlが重い模様・・・
 実際にコメントアウトすると、（Fcntlだけ外すとエラーになるのでuse Strictも外す）
 新規投稿フォームの表示が約1CPU秒から約0.5CPU秒になりました
 ちなみにFcntlが影響を与えるのはsysopen関数とflock関数を使っているところです
 #結局Fcntlは外してしまいました
 #それでもsylpheedには勝てません
 #多少重くてもHTTP転送の負荷で無視できるだろう、と
 あぁ、HTMLは重いと思います
 短い記事が多いと、HTML全体のバイト数が記事本文のバイト数の倍になる、ということもあるようです
 いわゆるシンプルビューは少なくともr1.3までは実装しません
 #やっぱりevalの負荷も大きそう。。
 #それでもローカルのHTML解析-表示のラグで消えますけど
□アイコンカタログCGIは重い？
 これは思ったよりも重くありません
 本来の記事表示よりも軽いくらいですね #アイコン618個の場合
□文字の範囲
 # EUC-JP文字
 [\x00-\x7F \x8E\x8F     \xA1-\xFC-\xFE]
 # SJIS文字
 [\x00-\x7F-\x8E\x8F\x90-\xA1-\xFC     ]
 判定用としては、「空(EUC:\xb6\xf5 SJIS:\x8b\xf3」よりも、
 「改(EUC:\xb2\xfe SJIS:\x89\xfc)」の方が適任かな？
 <-EUCの「空(\x8bf3)」は、
 SJIS文書内で「半角カタカナの"カ"+外字の1byte目」として現れるかもしれないからと、
 この文字だけでは判定してくれないことがある。。
□Perlソース内のコメント
 意識して書くようにしているので世の中でもコメントが多いほうではないでしょうか・・・
 r1.2.2.17のcore.cgiではコメントだけで19KBあるようです（ぉ
 まぁ、そのおかげで1年以上時々ブランクあけながらも修正できたわけですけどね
 コメントがなかったら絶対内容忘れていますｗｗ
 ちなみにコメントが他の場所と比べて明らかに少ないところは、あまり変更していないところです
 #変更しない→コメント書かない→忘れて変更できない→コメント書けない・・・
 あと=item〜=cutという所が結構ありますが、POD文書ではないです
 あくまで複数行にわたるコメントとして使っているのであって、それ以上でも以下でもありません
□連続投稿の防御
 こう見えて一応やってます、いちおう0.cgiの2行目がそれで、
 「スレッド番号:記事内容のサイズ:返信番号」
 を保存し、それと新たに来た投稿とを比べることによって行っています
 適当ですね^^;;
□HTML規格上は閉じタグを省略したり出来るけど、
 Mireilleでは面倒なので基本的にタグの省略、属性引用符の省略などには対応していません
 また、引用符は基本的に " を想定しています
 ひねった方法で書くと、処理を通した時に、タグの構成が崩れるかもしれません
□属性セレクタ
 CSS2ではこれによって
 INPUT.submitover → INPUT[type="submit"]:hover
 などとできるのだけど、IE6でも対応していないの
 今でも IE5+=behavior/N6=AtSe でいける？
 #面倒すぎて事実上いけないようなので諦めました
□アイコンリスト編集＃
 Marldiaの表情アイコンとの互換性を保つ目的で、
 マッチングを/^\s*([^#]+(?:#\d+)?)\s*\#\s*(.+)$/で行っているため、
 「hoe.png#uso#800」は「<OPTION value="hoe.png#uso">800</OPTION>」になりますが、
 「hoe.png#777#slot」は「<OPTION value="hoe.png#777">slot</OPTION>」になります
□日時形式の不思議
 ISO8601やらRFC822やらRFC2822やらと、日時に関する取り決めはいくつかあります
 
 現在の“標準”は Combinations of date and time of day として、
 ISO 8601の§5.4で定義されたもののようです
 形式は「1970-01-01T00:09:00+09:00」となります //UNIXepochの時刻を表す場合
 同じものが XML Schema Part 2: Datatypes でも dateTime として定義されています
 
 HTTPで主に使われるのはこれと異なり、RFC822っぽいもの、です
 「Thu, 01 Jan 1970 09:00:00 GMT」
 実際はRFC1123の形式でやり取りされている・・・みたいです
 HTTP関係は規格が定まる前に好き勝手やっていたものなので、色々と難しいみたい
 Last-Modifiedはこの形式でやり取りする模様
 
 Cookieでexpiresの値として使う形式はまた異なります
 「Thu, 01-Jan-1970 09:00:00 GMT」
 と、微妙に上の形式と違います
 CookieもNetscape社が独自に実装し、それを他社が真似た物なのです
 http://www.netscape.com/newsref/std/cookie_spec.html
 別にちゃんとRFCでCookieが仕様として策定されているのですが、黙殺されています
	 
 環境変数のTZは日本だと普通は JST-9 でよいとされています
 "set TZ=JST-9" / "$ENV{'TZ'}='JST-9';"
 タイムゾーンをあらわす文字列は多々存在し、日本時間を表すものとして
 「JST-9」「I」「V」「+0900」「+0900 (JST)」「+09:00」
 などなど、Iは-9時間、Vは+9時間を表すようですが、
 悲しいかな+/-が混同されたようであったも参考程度にしかならないとか
 数字で書く方では基本的に日本は + です
 「JST-9」が - なのは、日本時間から-9時間すると協定世界時になる、との意とか
 http://www.microsoft.com/JAPAN/developer/library/vccore/_crt__tzset.htm
 
 JSTの他にESTとかPSTとかあるけど、LT(LunaTime)やMT(MarsTime)なんてあるのね；）
 
 タイムゾーンをあらわすのに+/-どちらを使うかは慎重にしましょうと
 基本的には標準子午線より東側において、環境変数では - 、W3C系では + のようです
□ブラウザメモ＆愚痴
・WinIE
	ver6で主に動作確認をしていますが、ver5.01でもたまにしています
	WinIE5では巨大なスレッド（Res50を超える）だと、スレッドDIVのボーダーが部分的に消えます
	WinIE4では巨大なスレッドだと、部分的に記事が見れなくなります
	OPTGROUPにはver6から一応対応、将来的なツリーメニュー型への変更を期待しています
	常に期待の80%以上は動いてくれるので意外と使える
・MacIE
	多くの場合盲点になりがちなこのブラウザ
	ver4未満では使えないともっぱらの評判でしたが、ver5になってかなり使えるようになっています
	なんと記事ナビも普通に動いてくれます #半透明化は流石に無理、強引にやろうとすると落ちる
	Mireilleのバージョンによって表示が崩れたします
	OPTGROUPが有名どころのブラウザで唯一ツリーメニュー型なのがうれしい
	侮れないくらいに使えるのだけどMacだから触れる機会が稀
・Mozilla
	rv0.9ぐらいから記事ナビ周りでMozillaが落ちてしまうバグが散見されています
	しかも、直ったと思って安心するといつの間にかデグレードしいて、症状が再発したりします（斬
	この症状はあろうことかrv1.0でも発生します #RCでは直っていたのになぜ再発するの・・・
	とりあえず調べた限りでは、
	CSSで「:hover内に-moz-opacityを設定している要素の子要素でoverflow:auto;を指定している」
	という場合に、その子要素をクリックすると落ちるようです
	結局 -moz-opacity:1.0 → -moz-opacity:0.9 としたら落ちなくなったようです
	MSIEと同様(?)に「自分が標準」という強い自負があるのですよね
	実は独自拡張も結構しているのです #XUL関連を除いてもまだまだ
	OPTGROUPには一応対応、ツリーメニューへの変更を期待しています
	期待の90%以上動いてくれるけど妙なところが抜けていて結構重い
・Netscape6,7
	ブラウザの名称は"NetscapeNavigator6"ではありません
	ちょっと付録が多すぎて邪魔、特にAOLIMを強制添付するのはMSより悪質
	GaleonとかGeckoエンジンのブラウザは多々ありますが、表示機能はMozillaに準ずるので省略します
・Phoenix, K-meleon, Chimera, Galeon他
	Mozillaと同じ
・Opera
	Opera7でinnerHTMLやOPTGROUPにも対応しました
	betaではOPTION要素のbackground-colorが未だに反映されなかったり、一部表示が崩れたりします
	機能的には「第三のブラウザ」と名乗れるくらいになってきたかもしれません
	まだ記事ナビの半透明化には非対応
・NetscapeNavigator
	はやくきえてなくなれ
	1.2.3.1でCSSをN4でも使うようにしました
	おかげで邪魔なタグがたくさん・・・
	巨大なスレッド（子記事数が50を超える）だと部分的に記事が見れなくなる
・Konqueror
	ほどほどに動きます
・iCab
	昔はiCabが「第三のブラウザ」と呼ばれていた、と記憶しています
	最近どうなのですか？
	そして、Mireilleは表示できるのでしょうか？
	お返事待っています（何
・Amaya
	あのW3C謹製のWebブラウザです
	が・・・はっきり言ってヲタブラウザです（ぉ
	Amaya6.2にてやっと日本語表示に対応したのですが、大抵の日本語サイトでは表示しようとすると、
	ちょっと頑張っている様なそぶりを見せた後に、さくっと落ちます(笑
	OPTGROUPをツリーメニューにして表示してくれるのはうれしいのですけどね
	次のバージョンではまともに動くのでしょうか
	#Amaya6.3ではAiremixやMireilleを見れるようになりました、でも数分で落ちます
・Lynxとかw3mとか
	勘弁してくださいｗ
	積極的に対応作業をすることはありませんが、変更すべき点のリストをくださればマージはします
・i-modeみたいな
	「待っていればそのうちWinIEみたいに表示してくれるようになるだろう」
	と、とことん様子見とすることが内定しました
	#何度か需要調査したけど反応皆無だったのです
□サーバー別情報
・ccsnet.ne.jp
	#!/usr/bin/perl
	htaccess非対応
	CGIパーミッションは755
	管理人権限で稼動
	.plはCGIとみなす
・biglobe.ne.jp
	#!/usr/local/bin/perl
	htaccess非対応
・cool.ne.jp
	#!/usr/bin/perl
	htaccess対応
・infoseek.co.jp
	#!usr/local/bin/perl
	htaccess非対応
	CGIパーミッションは755
	ディレクトリは777
	ディレクトリ丸見え
	.plはCGIとみなされない
	cgi-binディレクトリ以下のみCGI動作
	広告あり
・tripod.co.jp
	拡張子で見るので関係なし
	パーミッションは関係なし
	Perlのバージョンが5.004_04なので動きません
	#かなり手を入れれば動きそうではあるけど。。
・sakura.ad.jp
	#!usr/local/bin/perl
	ディレクトリ、CGI共に755（777は不可）
・mixedmedia.net
	#!usr/local/bin/perl
	ディレクトリは755、CGIは700を推奨（777は不可）
	htaccess対応（exec系・OPTIONSディレクティブは不可）
	.plはCGIとみなす
・cside.jp
	#!usr/local/bin/perl
	ディレクトリ、CGI共に755推奨
	htaccess対応
	.plはCGIとみなされない
・tok2.com
	#!/usr/bin/perl
	CGIは700を推奨
	広告あり


#------------------------------------------------------------------------------#
◇品質特性(ISO/IEC9126)に基づく自己分析
□1 機能性 Functionality
 1.合目的性 Suitability
  管理CGI周りで不必要な機能が存在する可能性あり
 2.正確性 Accuracy
  おおむね達成できていると思われる
 3.相互運用性 Interoperability
  おおむね達成できていると思われる
 4.セキュリティ Security
  Mireille本体は、おおむね達成できていると思われる
  管理CGIは多少難ありか
 5.機能性適合性 Functional compliance
  HTML4.01Strict - 一部不適格
  CSS 1or2       - 一部不適格
  日本国法律     - 未調査
□2 信頼性 Reliability
 6.成熟性 Maturity
  まだまだ先長し
 7.障害許容性 Fault tolerance
  おおむね達成できていると思われる
 8.回復性 Recoverability
  おおむね達成できていると思われる
 9.信頼性適合性 Reliability compliance
  未調査
□3 使用性 Usability
 10.理解性 Understandability
  今のMireille.htmlはまだ不十分かな？
 11.習得性 Learnability
  CGIが使える人なら使えるはず
 12.運用性 Oprability
  CGI掲示板に「運用」というほど大げさなことはあるのかな
 13.快適性 Attractiveness
  達成できていると思われる、この部分最優先でやっているわけだし
  ただ、IE5orLater/N6/Mozilla以外だと微妙
 14.使用性適合性 Usability compliance
  未調査
□4 効率性 Efficiency
 15.時間効率性 Time behavior
  FANTASiXさんのSylpheedには負けるけど・・・
  おおむね達成できていると思われる
 16.資源効率性 Resource utilisation
  CGI/Perlごときで資源云々言うのもよくわからないけど、
  おおむね達成できていると思われる
 17.相効率性適合性 Efficiency compliance
  未調査
□5 保守性 Maintainability
 18.解析性 Analysability
  コメントはたくさんつけているつもり
  少なくとも成瀬は解析できる
  #いわゆる「自分でも読めない味わい深きスパゲッティ」にはなっていないｗ
 19.変更性 Changeability
  スクリプトですからそれは当然、解析できるわけだし
 20.安定性 Stability
  JavaScript周りに難あり
  むしろ現在進行形でMozillaはOperaは・・・
  Perl5.6--5.0間でもたまに発生する
 21.試験性 Testability
  気合があればローカルで
 22.保守性適合性 Maintainability compliance
  未調査
□6 移植性 Portability
 23.環境適合性 Adaptability
  Perlが動けばMireilleも動く、はず（flockも回避したし
 24.設置性 Installability
  ほどほど、かな
  パーミッション周りは一度はまると泥沼になるのだ
 25.共存性 Co-existence
  完璧、というかCGI/Perlで共存できないように作るほうが難しいと思われ
 26.置換性 Replaceability
  数件ログデータの移行も含めた実績あり
  ログデータの移行を考えなければ数多 #数多・・・見栄張ってますｗ
 27.移植性適合性 Portability compliance
  未調査

#------------------------------------------------------------------------------#
◇お世話になったところ
□Academic HTML http://www.tg.rim.or.jp/~hexane/ach/
 HTML,CSSに関する的確な情報がたくさんあります
 HTML,CSSを一通り学びたい場合はここを見るだけで事足りてしまいます
□Another HTML-lint http://openlab.ring.gr.jp/k16/htmllint/
 HTMLの検証に際し利用しました
 初めてチェックすると、ほとんどの人がショックを受けることでしょう
□ARTEMIS http://www.artemis.ac/arrange/
 IconPreviewはここからです、便利なので頂きました
 新しい投稿があると教えてくれる〜もここのを見て、です
 他にもいろいろと参考にしています
 管理機能でここを見習う点は数多くあります
□彼の野原 http://kano.feena.jp/
 LastPostはここのealisの真似です
 Rev:1.2.2の記事ナビは神乃さんのものベースに作りました
 DHTML周りではかないません^^;;
 tableを使わずに表示させようとしているのも尊敬します
 最近はPHP+PostgreSQLにはまっているとか
□HTML鳩丸倶楽部 http://www.ne.jp/asahi/minazuki/bakera/html/hatomaru
 ツッコミメインなHTML解説サイト、にわたしは見えました
 「HTML 4.01 のみを、純粋に学問的な興味から研究」しているそうです
 HTMLの構成に際して参考にしました
□jcode.pl http://www.srekcah.org/jcode/
 漢字コード変換用のライブラリです
 Mireille本体では横着しているので使っていません
 管理CGIでは一部を切り出して使っています
□Jcode.pm http://openlab.ring.gr.jp/Jcode/index-j.html
 jcode.plの後継でPerl5用PerlModuleとなっています
 jcode.plの機能にUnicodeを扱う機能が追加されています
□KENT-WEB http://www.kent-web.com/
 なにはともあれ日本のCGI/Perl界に与えた影響は少なくはないはずです
 私個人では特にYYBOARD,YYCHATにはお世話になりました
 きわめてとっつき易いCGIが多いです
□Perlメモ http://www.din.or.jp/~ohzaki/perl.htm
 URI自動リンク機能をつけるに際し参考に・・・むしろ丸写しです
 Perlの正規表現に関してとても有用な情報があります
□W3C HTML Validation Service http://validator.w3.org/
 HTML規格の策定を行う団体、W3CによるHTML検証サービスです
 Another HTML-lintよりチェック項目は少なめです
□とほほのWWW入門 http://tohoho.wakusei.ne.jp/
 HTML部、Perl部ともに時々リファレンス代わりにしました
 なかなか載っていて便利です
 それでも一部省略されているのが残念ですが、、
□Snowish Hills http://snowish.cside8.com/
 Mireilleを作りこむにあたって、有用なアドバイスを多数頂きました
 特に管理機能は西名さんに言われなければかなり貧弱なものになっていたでしょう
 初期状態のデザインも西名さんのデザインをベースにしています
 ちなみに、西名さんのサイト自体はKey系CGサイトです
□相談に乗ってもらったり、ツッコミ・要望・バグ報告をもらったり、普及に貢献してくださった方々
 imac零式さん、幽霊猫さん、西名さん、神乃さん、Bさん、TAKE4さん、かろかろさん、xbomさん
 #ある程度ツッコミを入れるとここに晒されるのです；）
□他にも意見を下さった方々、参考にしたサイト・CGIの作者さんに感謝します
MultiX.jp		http://multix.jp/
FANTASTiX		http://fantasien.cup.com/perl5/
CGI Pocket		http://pocket.727.net/
ゆいチャット	http://www.cup.com/yui/
The Web KANZAKI	http://www.kanzaki.com/
秀和システム 「詳解HTML&JavaScript辞典」
ASCIIが邦訳して出版 「Effective Perl」
技術評論社 「CGI & Perl ポケットリファレンス」
そのほかさまざま。。。

Copyright (c) 2001,2002 NARUSE,Yui(Airemix). All rights reserved.
